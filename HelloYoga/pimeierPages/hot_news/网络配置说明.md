# 网络配置说明

## 问题说明

在 iOS 应用中访问 `localhost` 时需要注意：

- **iOS 模拟器**：`localhost` 指向开发机器，可以直接使用
- **iOS 真机**：`localhost` 指向设备本身，无法访问开发机器的服务

## 解决方案

### 方案 1: 使用开发机器的 IP 地址（推荐）

1. **查找开发机器的 IP 地址**：
   ```bash
   # macOS/Linux
   ifconfig | grep "inet " | grep -v 127.0.0.1
   
   # 或者
   ipconfig getifaddr en0
   ```

2. **修改 API 地址**：
   编辑 `hot_news_logic.js`，将 `localhost` 替换为实际 IP：
   ```javascript
   // 示例：如果开发机器 IP 是 192.168.1.100
   var apiUrl = "http://192.168.1.100:5001/api/news/latest";
   ```

### 方案 2: 使用环境变量（推荐用于生产环境）

在代码中根据运行环境自动选择：

```javascript
// 检测运行环境
var isSimulator = false; // 可以通过 Pimeier.Device.getInfo() 判断
var baseURL = isSimulator ? "http://localhost:5001" : "http://192.168.1.100:5001";
var apiUrl = baseURL + "/api/news/latest";
```

### 方案 3: 配置化 API 地址

在 `hot_news_data.json` 中添加配置：

```json
{
  "apiBaseURL": "http://localhost:5001",
  "navTitle": "🔥 全网热榜",
  ...
}
```

然后在 JS 中使用：

```javascript
var apiUrl = (viewModel.apiBaseURL || "http://localhost:5001") + "/api/news/latest";
```

## 常见错误

### 错误 1: Could not connect to the server (Error -1004)

**原因**：无法连接到服务器

**解决方法**：
1. 确认服务器正在运行：`curl http://localhost:5001/api/news/latest`
2. 如果是真机，使用开发机器 IP 地址
3. 检查防火墙设置

### 错误 2: Request timeout

**原因**：请求超时

**解决方法**：
1. 增加超时时间
2. 检查网络连接
3. 确认服务器响应速度

### 错误 3: Network error

**原因**：网络错误

**解决方法**：
1. 检查网络连接
2. 确认服务器地址正确
3. 检查服务器日志

## 测试步骤

1. **在开发机器上测试 API**：
   ```bash
   curl http://localhost:5001/api/news/latest?limit=5
   ```

2. **在模拟器上测试**：
   - 使用 `http://localhost:5001`
   - 应该可以正常访问

3. **在真机上测试**：
   - 使用开发机器 IP 地址
   - 例如：`http://192.168.1.100:5001`
   - 确保设备和开发机器在同一网络

## 生产环境配置

在生产环境中，应该使用实际的服务器地址：

```javascript
var apiUrl = "https://api.yourdomain.com/api/news/latest";
```

