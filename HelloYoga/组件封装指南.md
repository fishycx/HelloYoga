# Pimeier UI ç»„ä»¶å°è£…æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•åœ¨ Pimeier æ¡†æ¶ä¸­å°è£…ä¸€ä¸ªæ–°çš„ UI ç»„ä»¶ï¼ˆå¦‚ Switchã€Slider ç­‰ï¼‰ã€‚

## ç›®å½•

1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [å°è£…æ­¥éª¤](#å°è£…æ­¥éª¤)
3. [è¯¦ç»†å®ç°](#è¯¦ç»†å®ç°)
4. [å®Œæ•´ç¤ºä¾‹](#å®Œæ•´ç¤ºä¾‹)
5. [æ³¨æ„äº‹é¡¹](#æ³¨æ„äº‹é¡¹)

---

## æ¦‚è¿°

åœ¨ Pimeier æ¡†æ¶ä¸­å°è£…ä¸€ä¸ªæ–° UI ç»„ä»¶éœ€è¦å®Œæˆä»¥ä¸‹ 5 ä¸ªæ­¥éª¤ï¼š

1. **å®šä¹‰ç»„ä»¶ç±»å‹**ï¼šåœ¨ `LayoutModels.swift` ä¸­æ·»åŠ æ–°çš„ `NodeType`
2. **XML è§£ææ”¯æŒ**ï¼šåœ¨ `XMLLayoutParser.swift` ä¸­æ·»åŠ  XML æ ‡ç­¾æ˜ å°„
3. **è§†å›¾åˆ›å»º**ï¼šåœ¨ `YogaNodeBuilder.swift` ä¸­æ·»åŠ è§†å›¾åˆ›å»ºé€»è¾‘
4. **æ ·å¼å±æ€§æ”¯æŒ**ï¼šåœ¨ `LayoutModels.swift` çš„ `ViewStyle` ä¸­æ·»åŠ å±æ€§è§£æ
5. **äº‹ä»¶ç»‘å®šå’Œæ•°æ®ç»‘å®š**ï¼šåœ¨ `PimeierRenderer.swift` ä¸­æ·»åŠ äº‹ä»¶å¤„ç†é€»è¾‘

---

## å°è£…æ­¥éª¤

### æ­¥éª¤ 1: å®šä¹‰ç»„ä»¶ç±»å‹

**æ–‡ä»¶**: `LocalPods/Pimeier/Classes/Core/LayoutModels.swift`

åœ¨ `LayoutNode.NodeType` æšä¸¾ä¸­æ·»åŠ æ–°çš„ç»„ä»¶ç±»å‹ï¼š

```swift
public enum NodeType: String {
    // ... ç°æœ‰ç±»å‹ ...
    
    // æ–°å¢ UI ç»„ä»¶
    case switch_ // Switch å¼€å…³ï¼ˆä½¿ç”¨ switch_ é¿å…ä¸ Swift å…³é”®å­—å†²çªï¼‰
    case slider  // Slider æ»‘å—
    case myNewComponent // ä½ çš„æ–°ç»„ä»¶
}
```

**æ³¨æ„äº‹é¡¹**ï¼š
- å¦‚æœç»„ä»¶åç§°æ˜¯ Swift å…³é”®å­—ï¼ˆå¦‚ `switch`ï¼‰ï¼Œä½¿ç”¨ä¸‹åˆ’çº¿åç¼€ï¼ˆå¦‚ `switch_`ï¼‰
- XML ä¸­å¯ä»¥ä½¿ç”¨åŸå§‹åç§°ï¼Œåœ¨è§£ææ—¶ä¼šæ˜ å°„åˆ°æ­£ç¡®çš„æšä¸¾å€¼

---

### æ­¥éª¤ 2: XML è§£ææ”¯æŒ

**æ–‡ä»¶**: `LocalPods/Pimeier/Classes/Parser/XMLLayoutParser.swift`

åœ¨ `parseNodeType` æ–¹æ³•ä¸­æ·»åŠ  XML æ ‡ç­¾åˆ°æšä¸¾å€¼çš„æ˜ å°„ï¼š

```swift
private func parseNodeType(_ tagName: String) -> LayoutNode.NodeType? {
    let lowercased = tagName.lowercased()
    
    // ... ç°æœ‰æ˜ å°„ ...
    
    // æ–°å¢æ˜ å°„
    if lowercased == "switch" {
        // switch æ˜¯ Swift å…³é”®å­—ï¼Œåœ¨ NodeType ä¸­ä½¿ç”¨ switch_ï¼Œä½† XML ä¸­å¯ä»¥ä½¿ç”¨ switch
        return "switch_"
    } else if lowercased == "slider" {
        return "slider"
    } else if lowercased == "mynewcomponent" {
        return "myNewComponent"
    }
    
    // å…¶ä»–æƒ…å†µä½¿ç”¨å…¨å°å†™
    return lowercased
}
```

**æ³¨æ„äº‹é¡¹**ï¼š
- XML æ ‡ç­¾åç§°ä¸åŒºåˆ†å¤§å°å†™
- å¦‚æœç»„ä»¶åç§°åŒ…å«å¤šä¸ªå•è¯ï¼ŒXML ä¸­å¯ä»¥ä½¿ç”¨è¿å­—ç¬¦æˆ–é©¼å³°å‘½å

---

### æ­¥éª¤ 3: è§†å›¾åˆ›å»º

**æ–‡ä»¶**: `LocalPods/Pimeier/Classes/Engine/YogaNodeBuilder.swift`

åœ¨ `createView(for:)` æ–¹æ³•ä¸­æ·»åŠ è§†å›¾åˆ›å»ºé€»è¾‘ï¼š

```swift
private func createView(for node: LayoutNode) -> UIView {
    let view: UIView
    switch node.type {
    // ... ç°æœ‰ case ...
    
    case .switch_:
        let switchControl = UISwitch()
        view = switchControl
        
    case .slider:
        let slider = UISlider()
        view = slider
        
    case .myNewComponent:
        let myView = MyNewComponent() // ä½ çš„è‡ªå®šä¹‰è§†å›¾
        view = myView
        
    // ... å…¶ä»– case ...
    }
    
    // è°ƒç”¨åˆ›å»ºå›è°ƒ
    onViewCreated?(view)
    return view
}
```

**æ³¨æ„äº‹é¡¹**ï¼š
- ç¡®ä¿åˆ›å»ºçš„è§†å›¾æ˜¯ `UIView` æˆ–å…¶å­ç±»
- å¦‚æœç»„ä»¶éœ€è¦ç‰¹æ®Šåˆå§‹åŒ–ï¼Œåœ¨è¿™é‡Œå®Œæˆ

---

### æ­¥éª¤ 4: æ ·å¼å±æ€§æ”¯æŒ

**æ–‡ä»¶**: `LocalPods/Pimeier/Classes/Core/LayoutModels.swift`

#### 4.1 åœ¨ `ViewStyle` ç»“æ„ä½“ä¸­æ·»åŠ å±æ€§

```swift
public struct ViewStyle {
    // ... ç°æœ‰å±æ€§ ...
    
    // Switch å±æ€§
    public var switchValue: Bool?
    public var onTintColor: UIColor?
    public var thumbTintColor: UIColor?
    
    // Slider å±æ€§
    public var sliderValue: Float?
    public var minimumValue: Float?
    public var maximumValue: Float?
    public var minimumTrackTintColor: UIColor?
    public var maximumTrackTintColor: UIColor?
    public var thumbTintColorSlider: UIColor?
    
    // ä½ çš„æ–°ç»„ä»¶å±æ€§
    public var myNewComponentProperty: String?
}
```

#### 4.2 åœ¨ `ViewStyle.from(attributes:)` æ–¹æ³•ä¸­æ·»åŠ å±æ€§è§£æ

```swift
public static func from(attributes: [String: String]) -> ViewStyle {
    var style = ViewStyle()
    
    for (key, value) in attributes {
        switch key.lowercased() {
        // ... ç°æœ‰ case ...
        
        // Switch å±æ€§
        case "value":
            // value å¯ä»¥æ˜¯å¸ƒå°”å€¼ï¼ˆSwitchï¼‰æˆ–æµ®ç‚¹æ•°ï¼ˆSliderï¼‰
            if let boolValue = parseBool(value) {
                style.switchValue = boolValue
            } else if let floatValue = Float(value) {
                style.sliderValue = floatValue
            }
        case "ontintcolor":
            style.onTintColor = parseColor(value)
        case "thumbtintcolor":
            style.thumbTintColor = parseColor(value)
        
        // Slider å±æ€§
        case "minimumvalue", "minvalue":
            style.minimumValue = Float(value)
        case "maximumvalue", "maxvalue":
            style.maximumValue = Float(value)
        case "minimumtracktintcolor":
            style.minimumTrackTintColor = parseColor(value)
        case "maximumtracktintcolor":
            style.maximumTrackTintColor = parseColor(value)
        case "thumbtintcolorslider":
            style.thumbTintColorSlider = parseColor(value)
        
        // ä½ çš„æ–°ç»„ä»¶å±æ€§
        case "mynewcomponentproperty":
            style.myNewComponentProperty = value
        
        default:
            break
        }
    }
    
    return style
}
```

#### 4.3 åœ¨ `YogaNodeBuilder.applyViewStyle(_:to:)` æ–¹æ³•ä¸­åº”ç”¨æ ·å¼

```swift
private func applyViewStyle(_ style: ViewStyle, to view: UIView) {
    // ... ç°æœ‰æ ·å¼åº”ç”¨ ...
    
    // Switch æ ·å¼
    if let switchControl = view as? UISwitch {
        // ç¡®ä¿ Switch å¯ä»¥äº¤äº’
        switchControl.isUserInteractionEnabled = true
        if let value = style.switchValue {
            switchControl.isOn = value
        }
        if let onTintColor = style.onTintColor {
            switchControl.onTintColor = onTintColor
        }
        if let thumbTintColor = style.thumbTintColor {
            switchControl.thumbTintColor = thumbTintColor
        }
    }
    
    // Slider æ ·å¼
    if let slider = view as? UISlider {
        // ç¡®ä¿ Slider å¯ä»¥äº¤äº’
        slider.isUserInteractionEnabled = true
        if let value = style.sliderValue {
            slider.value = value
        }
        if let minimumValue = style.minimumValue {
            slider.minimumValue = minimumValue
        }
        if let maximumValue = style.maximumValue {
            slider.maximumValue = maximumValue
        }
        if let minimumTrackTintColor = style.minimumTrackTintColor {
            slider.minimumTrackTintColor = minimumTrackTintColor
        }
        if let maximumTrackTintColor = style.maximumTrackTintColor {
            slider.maximumTrackTintColor = maximumTrackTintColor
        }
        if let thumbTintColor = style.thumbTintColorSlider {
            slider.thumbTintColor = thumbTintColor
        }
    }
    
    // ä½ çš„æ–°ç»„ä»¶æ ·å¼
    if let myView = view as? MyNewComponent {
        if let property = style.myNewComponentProperty {
            myView.setProperty(property)
        }
    }
}
```

**æ³¨æ„äº‹é¡¹**ï¼š
- å±æ€§åç§°åœ¨ XML ä¸­ä¸åŒºåˆ†å¤§å°å†™
- ä½¿ç”¨ `parseColor()` è§£æé¢œè‰²å€¼ï¼ˆæ”¯æŒåå…­è¿›åˆ¶ã€é¢„å®šä¹‰é¢œè‰²åç­‰ï¼‰
- ä½¿ç”¨ `parseBool()` è§£æå¸ƒå°”å€¼
- ç¡®ä¿äº¤äº’å¼æ§ä»¶è®¾ç½® `isUserInteractionEnabled = true`

---

### æ­¥éª¤ 5: äº‹ä»¶ç»‘å®šå’Œæ•°æ®ç»‘å®š

**æ–‡ä»¶**: `LocalPods/Pimeier/Classes/Engine/PimeierRenderer.swift`

åœ¨ `bindEvents(for:attributes:originalAttributes:context:)` æ–¹æ³•ä¸­æ·»åŠ äº‹ä»¶å¤„ç†é€»è¾‘ï¼š

```swift
private func bindEvents(for view: UIView, attributes: [String: String], originalAttributes: [String: String], context: JSValue?) {
    // ... ç°æœ‰äº‹ä»¶ç»‘å®š ...
    
    // å¤„ç† UISwitch çš„ onChange äº‹ä»¶å’ŒåŒå‘ç»‘å®š
    if let switchControl = view as? UISwitch {
        // æŸ¥æ‰¾ onChange äº‹ä»¶å’Œ value ç»‘å®š
        var onChangeScript: String?
        for (key, value) in attributes {
            if key.lowercased() == "onchange" {
                onChangeScript = value
                break
            }
        }
        
        var bindingExpression: String?
        if let valueAttr = originalAttributes["value"] {
            let pattern = "^\\{\\{(.+?)\\}\\}$"
            if let regex = try? NSRegularExpression(pattern: pattern, options: []),
               let match = regex.firstMatch(in: valueAttr, options: [], range: NSRange(location: 0, length: valueAttr.utf16.count)),
               let range = Range(match.range(at: 1), in: valueAttr) {
                bindingExpression = String(valueAttr[range]).trimmingCharacters(in: .whitespaces)
                print("ğŸ”— [Renderer] Switch binding detected: \(bindingExpression ?? "nil")")
            }
        }
        
        // å¦‚æœå­˜åœ¨ onChange æˆ– value ç»‘å®šï¼Œåˆ›å»ºç»Ÿä¸€çš„ wrapper
        if onChangeScript != nil || bindingExpression != nil {
            let wrapper = SwitchChangeWrapper { [weak self] isOn in
                // 1. å…ˆæ‰§è¡ŒåŒå‘ç»‘å®šï¼ˆå¦‚æœæœ‰ï¼‰
                if let expression = bindingExpression {
                    let script = "\(expression) = \(isOn ? "true" : "false")"
                    _ = self?.evaluateExpression(script, context: context)
                }
                
                // 2. å†æ‰§è¡Œ onChange äº‹ä»¶ï¼ˆå¦‚æœæœ‰ï¼‰
                if let onChange = onChangeScript {
                    // ç›´æ¥åœ¨åŸ context ä¸Šè®¾ç½® value å±æ€§ï¼Œè€Œä¸æ˜¯åˆ›å»ºæ–° context
                    // è¿™æ ·å¯ä»¥ä¿æŒ item å’Œ index çš„å¼•ç”¨ï¼ŒåŒæ—¶æ·»åŠ  value
                    if let originalContext = context, !originalContext.isUndefined {
                        // åœ¨åŸ context ä¸Šè®¾ç½® value å±æ€§
                        originalContext.setValue(isOn, forProperty: "value")
                        _ = self?.evaluateExpression(onChange, context: originalContext)
                    } else {
                        // å¦‚æœæ²¡æœ‰åŸ contextï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„
                        let contextData: [String: Any] = ["value": isOn]
                        if let jsonData = try? JSONSerialization.data(withJSONObject: contextData, options: []),
                           let jsonString = String(data: jsonData, encoding: .utf8),
                           let jsContext = self?.createJSValue(fromJson: jsonString) {
                            _ = self?.evaluateExpression(onChange, context: jsContext)
                        } else {
                            _ = self?.evaluateExpression(onChange, context: context)
                        }
                    }
                }
            }
            objc_setAssociatedObject(switchControl, &SwitchChangeWrapper.associatedKey, wrapper, .OBJC_ASSOCIATION_RETAIN_NONATOMIC)
            switchControl.addTarget(wrapper, action: #selector(SwitchChangeWrapper.valueChanged(_:)), for: .valueChanged)
        }
    }
    
    // å¤„ç† UISlider çš„ onChange äº‹ä»¶å’ŒåŒå‘ç»‘å®šï¼ˆç±»ä¼¼ Switchï¼‰
    if let slider = view as? UISlider {
        // ... ç±»ä¼¼ Switch çš„å®ç° ...
    }
}
```

#### 5.1 åˆ›å»ºäº‹ä»¶åŒ…è£…å™¨ç±»

åœ¨ `PimeierRenderer.swift` æ–‡ä»¶æœ«å°¾æ·»åŠ äº‹ä»¶åŒ…è£…å™¨ç±»ï¼š

```swift
// Switch å˜æ›´åŒ…è£…å™¨
class SwitchChangeWrapper: NSObject {
    static var associatedKey = "SwitchChangeWrapperKey"
    let callback: (Bool) -> Void
    
    init(callback: @escaping (Bool) -> Void) {
        self.callback = callback
    }
    
    @objc func valueChanged(_ sender: UISwitch) {
        callback(sender.isOn)
    }
}

// Slider å˜æ›´åŒ…è£…å™¨
class SliderChangeWrapper: NSObject {
    static var associatedKey = "SliderChangeWrapperKey"
    let callback: (Float) -> Void
    
    init(callback: @escaping (Float) -> Void) {
        self.callback = callback
    }
    
    @objc func valueChanged(_ sender: UISlider) {
        callback(sender.value)
    }
}
```

**æ³¨æ„äº‹é¡¹**ï¼š
- ä½¿ç”¨ `originalAttributes` æ£€æŸ¥åŒå‘ç»‘å®šè¡¨è¾¾å¼ï¼ˆå› ä¸º `attributes` ä¸­çš„å€¼å·²ç»è¢«è§£ææ›¿æ¢ï¼‰
- åŒå‘ç»‘å®šè¡¨è¾¾å¼æ ¼å¼ï¼š`value="{{ viewModel.propertyName }}"` æˆ– `value="{{ item.propertyName }}"`
- onChange äº‹ä»¶æ ¼å¼ï¼š`onChange="functionName(item.id, value)"` æˆ– `onChange="viewModel.methodName(item.id, value)"`
- **é‡è¦**ï¼šonChange äº‹ä»¶ä¸­å¯ä»¥ç›´æ¥è®¿é—® `item` å’Œ `index`ï¼ˆå¦‚æœåœ¨ ListView ä¸­ä½¿ç”¨ï¼‰ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨åŸ context ä¸Šè®¾ç½®äº† `value` å±æ€§
- ä½¿ç”¨ `objc_setAssociatedObject` ä¿å­˜ wrapperï¼Œé¿å…å†…å­˜æ³„æ¼
- ç¡®ä¿åœ¨æ­£ç¡®çš„ UIControl äº‹ä»¶ä¸Šæ·»åŠ  targetï¼ˆå¦‚ `.valueChanged`ï¼‰
- **æ€§èƒ½ä¼˜åŒ–**ï¼šåœ¨ onChange äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ï¼Œé€šå¸¸ä¸éœ€è¦è°ƒç”¨ `render()`ï¼Œå› ä¸ºåŒå‘ç»‘å®šå·²ç»æ›´æ–°äº†å€¼ï¼Œæ§ä»¶æœ¬èº«å·²ç»æ˜¾ç¤ºäº†æ­£ç¡®çš„çŠ¶æ€ã€‚åªæœ‰åœ¨éœ€è¦æ›´æ–°å…¶ä»–ä¾èµ–è¯¥å€¼çš„ UI å…ƒç´ æ—¶æ‰è°ƒç”¨ `render()`

---

## å®Œæ•´ç¤ºä¾‹

### ç¤ºä¾‹ï¼šå°è£… Switch ç»„ä»¶

#### XML ä½¿ç”¨æ–¹å¼

```xml
<switch 
    value="{{ item.switchValue }}"
    onTintColor="#34C759"
    onChange="onSwitchChange(item.id, value)"
    width="51"
    height="31"/>
```

#### JavaScript å¤„ç†å‡½æ•°

```javascript
function onSwitchChange(id, value) {
    log("Switch changed: id=" + id + ", value=" + value);
    
    // æ³¨æ„ï¼šåŒå‘ç»‘å®šå·²ç»æ›´æ–°äº† item.switchValueï¼Œè¿™é‡Œåªéœ€è¦å¤„ç†ä¸šåŠ¡é€»è¾‘
    // ä¸éœ€è¦å†æ¬¡æ›´æ–°æ•°æ®æˆ–è°ƒç”¨ render()
    
    // æ˜¾ç¤º Toast
    var status = value ? "å·²å¼€å¯" : "å·²å…³é—­";
    Pimeier.Toast.show("å¼€å…³ " + id + " " + status);
    
    // æ³¨æ„ï¼šä¸è¦è°ƒç”¨ render()ï¼Œå› ä¸ºåŒå‘ç»‘å®šå·²ç»æ›´æ–°äº†å€¼ï¼Œæ§ä»¶æœ¬èº«å·²ç»æ˜¾ç¤ºäº†æ­£ç¡®çš„çŠ¶æ€
    // å¦‚æœç¡®å®éœ€è¦æ›´æ–°å…¶ä»–ä¾èµ–è¯¥å€¼çš„ UI å…ƒç´ ï¼Œå¯ä»¥åœ¨è¿™é‡Œè°ƒç”¨ render()
    // ä½†å¯¹äº Switch å’Œ Slider è¿™ç§äº¤äº’å¼æ§ä»¶ï¼Œé€šå¸¸ä¸éœ€è¦ç«‹å³é‡æ–°æ¸²æŸ“æ•´ä¸ªé¡µé¢
}
```

### ç¤ºä¾‹ï¼šå°è£… Slider ç»„ä»¶

#### XML ä½¿ç”¨æ–¹å¼

```xml
<slider 
    value="{{ viewModel.sliderValue }}"
    minimumValue="0"
    maximumValue="100"
    minimumTrackTintColor="#007AFF"
    maximumTrackTintColor="#E0E0E0"
    thumbTintColor="#007AFF"
    onChange="onSliderChange(item.id, value)"
    width="100%"
    height="31"/>
```

#### JavaScript å¤„ç†å‡½æ•°

```javascript
function onSliderChange(id, value) {
    log("Slider changed: id=" + id + ", value=" + value);
    
    // æ³¨æ„ï¼šåŒå‘ç»‘å®šå·²ç»æ›´æ–°äº† item.sliderValueï¼Œè¿™é‡Œåªéœ€è¦å¤„ç†ä¸šåŠ¡é€»è¾‘
    // ä¸éœ€è¦å†æ¬¡æ›´æ–°æ•°æ®æˆ–è°ƒç”¨ render()
    
    // æ˜¾ç¤º Toastï¼ˆå¯é€‰ï¼Œé¿å…é¢‘ç¹è§¦å‘ï¼‰
    // Pimeier.Toast.show("æ»‘å— " + id + " å€¼: " + Math.round(value));
    
    // æ³¨æ„ï¼šä¸è¦è°ƒç”¨ render()ï¼Œå› ä¸ºåŒå‘ç»‘å®šå·²ç»æ›´æ–°äº†å€¼ï¼Œæ§ä»¶æœ¬èº«å·²ç»æ˜¾ç¤ºäº†æ­£ç¡®çš„çŠ¶æ€
    // å¦‚æœç¡®å®éœ€è¦æ›´æ–°å…¶ä»–ä¾èµ–è¯¥å€¼çš„ UI å…ƒç´ ï¼ˆæ¯”å¦‚æ˜¾ç¤ºæ•°å€¼çš„æ–‡æœ¬ï¼‰ï¼Œå¯ä»¥åœ¨è¿™é‡Œè°ƒç”¨ render()
    // ä½†å¯¹äº Slider è¿™ç§é¢‘ç¹äº¤äº’çš„æ§ä»¶ï¼Œé€šå¸¸ä¸éœ€è¦ç«‹å³é‡æ–°æ¸²æŸ“æ•´ä¸ªé¡µé¢
    // å¦‚æœéœ€è¦æ›´æ–°æ˜¾ç¤ºçš„æ•°å€¼æ–‡æœ¬ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æ›´ç»†ç²’åº¦çš„æ›´æ–°æœºåˆ¶
}
```

---

## æ³¨æ„äº‹é¡¹

### 1. äº¤äº’å¼æ§ä»¶åœ¨ ListView ä¸­çš„å¤„ç†

å¦‚æœç»„ä»¶è¦åœ¨ `PimeierListView` ä¸­ä½¿ç”¨ï¼Œéœ€è¦ç¡®ä¿ï¼š

- åœ¨ `YogaNodeBuilder.applyViewStyle` ä¸­è®¾ç½® `isUserInteractionEnabled = true`
- åœ¨ `PimeierListView.shouldSelectItemAt` ä¸­æ­£ç¡®å¤„ç†è§¦æ‘¸äº‹ä»¶ï¼Œé¿å… cell é€‰æ‹©äº‹ä»¶æ‹¦æˆªæ§ä»¶äº¤äº’

### 2. å°ºå¯¸è®¾ç½®

ç¡®ä¿åœ¨ XML ä¸­ä¸ºç»„ä»¶è®¾ç½®æ˜ç¡®çš„å°ºå¯¸ï¼š

```xml
<switch width="51" height="31"/>
<slider width="100%" height="31"/>
```

### 3. é¢œè‰²å€¼è§£æ

æ”¯æŒçš„é¢œè‰²æ ¼å¼ï¼š
- é¢„å®šä¹‰é¢œè‰²ï¼š`red`, `blue`, `systemBlue` ç­‰
- åå…­è¿›åˆ¶ï¼š`#FF0000` (RGB) æˆ– `#FF0000FF` (RGBA)

### 4. å¸ƒå°”å€¼è§£æ

æ”¯æŒçš„å¸ƒå°”å€¼æ ¼å¼ï¼š
- `true`, `1`, `yes`, `on` â†’ `true`
- `false`, `0`, `no`, `off` â†’ `false`

### 5. äº‹ä»¶ç»‘å®šä¼˜å…ˆçº§å’Œ Context å¤„ç†

- å¦‚æœåŒæ—¶è®¾ç½®äº† `onChange` å’Œ `value` åŒå‘ç»‘å®šï¼Œä¼šå…ˆæ‰§è¡ŒåŒå‘ç»‘å®šï¼Œå†æ‰§è¡Œ onChange äº‹ä»¶
- onChange äº‹ä»¶ä¸­å¯ä»¥é€šè¿‡ `value` å˜é‡è®¿é—®å½“å‰å€¼
- **é‡è¦**ï¼šonChange äº‹ä»¶å¤„ç†æ—¶ï¼Œä¼šåœ¨åŸ context ä¸Šç›´æ¥è®¾ç½® `value` å±æ€§ï¼Œè¿™æ ·å¯ä»¥ä¿æŒ `item` å’Œ `index` çš„å¼•ç”¨ï¼ˆå¦‚æœåœ¨ ListView ä¸­ä½¿ç”¨ï¼‰
- è¿™æ„å‘³ç€åœ¨ onChange äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ï¼Œå¯ä»¥åŒæ—¶è®¿é—® `item`ã€`index` å’Œ `value`ï¼Œä¾‹å¦‚ï¼š`onChange="onSliderChange(item.id, value)"`

### 6. å†…å­˜ç®¡ç†

- ä½¿ç”¨ `weak self` é¿å…å¾ªç¯å¼•ç”¨
- ä½¿ç”¨ `objc_setAssociatedObject` ä¿å­˜ wrapperï¼Œç¡®ä¿ç”Ÿå‘½å‘¨æœŸæ­£ç¡®

### 7. è°ƒè¯•å»ºè®®

- åœ¨å…³é”®ä½ç½®æ·»åŠ  `print` æ—¥å¿—ï¼Œä¾¿äºæ’æŸ¥é—®é¢˜
- æ£€æŸ¥ `isUserInteractionEnabled` æ˜¯å¦æ­£ç¡®è®¾ç½®
- éªŒè¯äº‹ä»¶åŒ…è£…å™¨æ˜¯å¦æ­£ç¡®åˆ›å»ºå’Œç»‘å®š

---

## æ€»ç»“

å°è£…ä¸€ä¸ªæ–° UI ç»„ä»¶çš„å®Œæ•´æµç¨‹ï¼š

1. âœ… åœ¨ `LayoutModels.swift` ä¸­æ·»åŠ  `NodeType`
2. âœ… åœ¨ `XMLLayoutParser.swift` ä¸­æ·»åŠ  XML æ ‡ç­¾æ˜ å°„
3. âœ… åœ¨ `YogaNodeBuilder.swift` ä¸­æ·»åŠ è§†å›¾åˆ›å»ºé€»è¾‘
4. âœ… åœ¨ `LayoutModels.swift` ä¸­æ·»åŠ æ ·å¼å±æ€§æ”¯æŒ
5. âœ… åœ¨ `PimeierRenderer.swift` ä¸­æ·»åŠ äº‹ä»¶ç»‘å®šå’Œæ•°æ®ç»‘å®š

å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œå°±å¯ä»¥åœ¨ XML å¸ƒå±€æ–‡ä»¶ä¸­ä½¿ç”¨æ–°ç»„ä»¶äº†ï¼

---

## å‚è€ƒ

- Switch ç»„ä»¶å®ç°ï¼š`LocalPods/Pimeier/Classes/Engine/PimeierRenderer.swift` (ç¬¬ 443-489 è¡Œ)
- Slider ç»„ä»¶å®ç°ï¼š`LocalPods/Pimeier/Classes/Engine/PimeierRenderer.swift` (ç¬¬ 491-537 è¡Œ)
- æ ·å¼åº”ç”¨ï¼š`LocalPods/Pimeier/Classes/Engine/YogaNodeBuilder.swift` (ç¬¬ 605-638 è¡Œ)

